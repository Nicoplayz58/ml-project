
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Evaluación de Modelos - Home Credit Default Risk &#8212; Machine Learning - Home Credit Problem</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Modelos Home Credit';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ANÁLISIS SERIES DE TIEMPO DE BITCOIN" href="bitcoin.html" />
    <link rel="prev" title="Análisis Exploratorio de Datos (EDA) - Home Credit Default Risk" href="EDA%20Home%20Credit%20P1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Machine Learning - Home Credit Problem - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Machine Learning - Home Credit Problem - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Bienvenido a nuestro proyecto final 🚀
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="EDA%20Home%20Credit%20P1.html">Análisis Exploratorio de Datos (EDA) - Home Credit Default Risk</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Evaluación de Modelos - Home Credit Default Risk</a></li>





<li class="toctree-l1"><a class="reference internal" href="bitcoin.html">ANÁLISIS SERIES DE TIEMPO DE BITCOIN</a></li>





























</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nicoplayz58/home-credit" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nicoplayz58/home-credit/issues/new?title=Issue%20on%20page%20%2FModelos Home Credit.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Modelos Home Credit.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Evaluación de Modelos - Home Credit Default Risk</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Evaluación de Modelos - Home Credit Default Risk</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivos-de-esta-etapa">Objetivos de esta etapa</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-de-datos">Carga de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#diccionario-de-datos">Diccionario de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#limpieza-de-datos">Limpieza de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#despliegue-de-modelos">Despliegue de modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-para-mostrar-resultados">Función para mostrar resultados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-con-penalizacion-l1-y-l2">Modelo de regresión logística con penalización L1 Y L2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-naive-bayes">Modelo de clasificación Naive Bayes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-random-forest">Modelo de clasificación Random Forest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-xgboost">Modelo de clasificación XGBoost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-svm">Modelo de clasificación SVM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-modelo-original-con-lightgbm">Propuesta Modelo Original con LightGBM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-de-modelo-bcsca-binary-classification-based-side-channel-analysis">Propuesta de modelo: BCSCA (Binary Classification-Based Side-Channel Analysis)</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="evaluacion-de-modelos-home-credit-default-risk">
<h1>Evaluación de Modelos - Home Credit Default Risk<a class="headerlink" href="#evaluacion-de-modelos-home-credit-default-risk" title="Link to this heading">#</a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Link to this heading">#</a></h2>
<p>Una vez realizado el análisis exploratorio de datos y el preprocesamiento correspondiente, el siguiente paso clave es entrenar y evaluar diferentes modelos de machine learning para predecir el riesgo de incumplimiento por parte de los clientes. La variable objetivo (<code class="docutils literal notranslate"><span class="pre">TARGET</span></code>) indica si un cliente ha tenido dificultades para pagar su préstamo, y el objetivo de esta sección es construir modelos capaces de predecir correctamente este riesgo.</p>
</section>
<section id="objetivos-de-esta-etapa">
<h2>Objetivos de esta etapa<a class="headerlink" href="#objetivos-de-esta-etapa" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Implementar pipelines de entrenamiento</strong>: Utilizar <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> de <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code> para estructurar el flujo de preprocesamiento y modelado, garantizando reproducibilidad y limpieza en el código.</p></li>
<li><p><strong>Entrenar múltiples modelos de clasificación</strong>: Incluir algoritmos como regresión logística, árboles de decisión, Random Forest, XGBoost, LightGBM, MLPs personalizados (como el adaptador BCSCA) y compararlos bajo las mismas condiciones.</p></li>
<li><p><strong>Evaluar el desempeño de cada modelo</strong>: Mediante métricas clave como AUC, accuracy, recall para la clase positiva (riesgo), precisión, F1-score, y curvas ROC.</p></li>
<li><p><strong>Identificar fortalezas y debilidades</strong>: Detectar qué modelos tienen mayor capacidad para identificar correctamente a los clientes que no pagarán (clase 1) sin sacrificar demasiada precisión.</p></li>
<li><p><strong>Comparar resultados y seleccionar los mejores modelos</strong>: No solo por su desempeño, sino también por su tiempo de entrenamiento y facilidad de implementación.</p></li>
</ol>
<p>Este enfoque sistemático nos permitirá encontrar la mejor combinación de modelo y configuración para abordar el problema del riesgo de crédito en el contexto de los datos de Home Credit.</p>
</section>
</section>
<section id="carga-de-datos">
<h1>Carga de datos<a class="headerlink" href="#carga-de-datos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Lista de archivos</span>
<span class="n">archivos</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train_final&quot;</span><span class="p">:</span> <span class="s2">&quot;train_final.csv&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Cargar archivos sin procesar, sin mostrar error si no existen</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">archivo</span> <span class="ow">in</span> <span class="n">archivos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">archivo</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># No muestra nada si no se encuentra el archivo</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="diccionario-de-datos">
<h1>Diccionario de datos<a class="headerlink" href="#diccionario-de-datos" title="Link to this heading">#</a></h1>
<p>A continuación podrán observar el diccionario de los datos con los que vamos a trabajar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Intenta leer el archivo con diferentes codificaciones</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;HomeCredit_Columns_description.csv&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;HomeCredit_Columns_description.csv&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;ISO-8859-1&quot;</span><span class="p">)</span>  <span class="c1"># Alternativa</span>

<span class="c1"># Extraer train_final</span>
<span class="n">train_final</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;train_final&quot;</span><span class="p">]</span>

<span class="c1"># Extraer las variables únicas de train_final en un DataFrame</span>
<span class="n">train_variables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_final</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Row&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="c1"># Eliminar duplicados en el DataFrame de descripciones para evitar repetición de variables</span>
<span class="n">description_cleaned</span> <span class="o">=</span> <span class="n">description</span><span class="p">[[</span><span class="s1">&#39;Row&#39;</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="c1"># Cruzar con el DataFrame de descripciones</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">train_variables</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">description_cleaned</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Row&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

<span class="c1"># Configurar Pandas para mostrar toda la tabla sin truncamientos</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las filas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Mostrar todas las columnas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># Evitar que se corte el texto en columnas largas</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.expand_frame_repr&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Evita que las columnas se dividan en varias líneas</span>

<span class="c1"># Mostrar la tabla completa en Jupyter Notebook</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Row</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>SK_ID_CURR</td>
      <td>ID of loan in our sample</td>
    </tr>
    <tr>
      <th>1</th>
      <td>TARGET</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NAME_CONTRACT_TYPE_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CODE_GENDER</td>
      <td>Gender of the client</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FLAG_OWN_CAR</td>
      <td>Flag if the client owns a car</td>
    </tr>
    <tr>
      <th>5</th>
      <td>FLAG_OWN_REALTY</td>
      <td>Flag if client owns a house or flat</td>
    </tr>
    <tr>
      <th>6</th>
      <td>CNT_CHILDREN</td>
      <td>Number of children the client has</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AMT_INCOME_TOTAL</td>
      <td>Income of the client</td>
    </tr>
    <tr>
      <th>8</th>
      <td>AMT_CREDIT_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>AMT_ANNUITY_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10</th>
      <td>AMT_GOODS_PRICE_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NAME_TYPE_SUITE_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>NAME_INCOME_TYPE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>13</th>
      <td>NAME_EDUCATION_TYPE</td>
      <td>Level of highest education the client achieved</td>
    </tr>
    <tr>
      <th>14</th>
      <td>NAME_FAMILY_STATUS</td>
      <td>Family status of the client</td>
    </tr>
    <tr>
      <th>15</th>
      <td>NAME_HOUSING_TYPE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16</th>
      <td>REGION_POPULATION_RELATIVE</td>
      <td>Normalized population of region where client lives (higher number means the client lives in more populated region)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>DAYS_BIRTH</td>
      <td>Client's age in days at the time of application</td>
    </tr>
    <tr>
      <th>18</th>
      <td>DAYS_EMPLOYED</td>
      <td>How many days before the application the person started current employment</td>
    </tr>
    <tr>
      <th>19</th>
      <td>DAYS_REGISTRATION</td>
      <td>How many days before the application did client change his registration</td>
    </tr>
    <tr>
      <th>20</th>
      <td>DAYS_ID_PUBLISH</td>
      <td>How many days before the application did client change the identity document with which he applied for the loan</td>
    </tr>
    <tr>
      <th>21</th>
      <td>OWN_CAR_AGE</td>
      <td>Age of client's car</td>
    </tr>
    <tr>
      <th>22</th>
      <td>FLAG_MOBIL</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>23</th>
      <td>FLAG_EMP_PHONE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>FLAG_WORK_PHONE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25</th>
      <td>FLAG_CONT_MOBILE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>26</th>
      <td>FLAG_PHONE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>27</th>
      <td>FLAG_EMAIL</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>28</th>
      <td>OCCUPATION_TYPE</td>
      <td>What kind of occupation does the client have</td>
    </tr>
    <tr>
      <th>29</th>
      <td>CNT_FAM_MEMBERS</td>
      <td>How many family members does client have</td>
    </tr>
    <tr>
      <th>30</th>
      <td>REGION_RATING_CLIENT</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>31</th>
      <td>REGION_RATING_CLIENT_W_CITY</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>32</th>
      <td>WEEKDAY_APPR_PROCESS_START_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>33</th>
      <td>HOUR_APPR_PROCESS_START_x</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>REG_REGION_NOT_LIVE_REGION</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>35</th>
      <td>REG_REGION_NOT_WORK_REGION</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>36</th>
      <td>LIVE_REGION_NOT_WORK_REGION</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>37</th>
      <td>REG_CITY_NOT_LIVE_CITY</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>38</th>
      <td>REG_CITY_NOT_WORK_CITY</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>39</th>
      <td>LIVE_CITY_NOT_WORK_CITY</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>40</th>
      <td>ORGANIZATION_TYPE</td>
      <td>Type of organization where client works</td>
    </tr>
    <tr>
      <th>41</th>
      <td>EXT_SOURCE_1</td>
      <td>Normalized score from external data source</td>
    </tr>
    <tr>
      <th>42</th>
      <td>EXT_SOURCE_2</td>
      <td>Normalized score from external data source</td>
    </tr>
    <tr>
      <th>43</th>
      <td>EXT_SOURCE_3</td>
      <td>Normalized score from external data source</td>
    </tr>
    <tr>
      <th>44</th>
      <td>APARTMENTS_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>45</th>
      <td>BASEMENTAREA_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>46</th>
      <td>YEARS_BEGINEXPLUATATION_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>47</th>
      <td>YEARS_BUILD_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>48</th>
      <td>COMMONAREA_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>49</th>
      <td>ELEVATORS_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>50</th>
      <td>ENTRANCES_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>51</th>
      <td>FLOORSMAX_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>52</th>
      <td>FLOORSMIN_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>53</th>
      <td>LANDAREA_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>54</th>
      <td>LIVINGAPARTMENTS_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>55</th>
      <td>LIVINGAREA_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>56</th>
      <td>NONLIVINGAPARTMENTS_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>57</th>
      <td>NONLIVINGAREA_AVG</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>58</th>
      <td>APARTMENTS_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>59</th>
      <td>BASEMENTAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>60</th>
      <td>YEARS_BEGINEXPLUATATION_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>61</th>
      <td>YEARS_BUILD_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>62</th>
      <td>COMMONAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>63</th>
      <td>ELEVATORS_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>64</th>
      <td>ENTRANCES_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>65</th>
      <td>FLOORSMAX_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>66</th>
      <td>FLOORSMIN_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>67</th>
      <td>LANDAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>68</th>
      <td>LIVINGAPARTMENTS_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>69</th>
      <td>LIVINGAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>70</th>
      <td>NONLIVINGAPARTMENTS_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>71</th>
      <td>NONLIVINGAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>72</th>
      <td>APARTMENTS_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>73</th>
      <td>BASEMENTAREA_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>74</th>
      <td>YEARS_BEGINEXPLUATATION_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>75</th>
      <td>YEARS_BUILD_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>76</th>
      <td>COMMONAREA_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>77</th>
      <td>ELEVATORS_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>78</th>
      <td>ENTRANCES_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>79</th>
      <td>FLOORSMAX_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>80</th>
      <td>FLOORSMIN_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>81</th>
      <td>LANDAREA_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>82</th>
      <td>LIVINGAPARTMENTS_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>83</th>
      <td>LIVINGAREA_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>84</th>
      <td>NONLIVINGAPARTMENTS_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>85</th>
      <td>NONLIVINGAREA_MEDI</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>86</th>
      <td>FONDKAPREMONT_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>87</th>
      <td>HOUSETYPE_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>88</th>
      <td>TOTALAREA_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>89</th>
      <td>WALLSMATERIAL_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>90</th>
      <td>EMERGENCYSTATE_MODE</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>91</th>
      <td>OBS_30_CNT_SOCIAL_CIRCLE</td>
      <td>How many observation of client's social surroundings with observable 30 DPD (days past due) default</td>
    </tr>
    <tr>
      <th>92</th>
      <td>DEF_30_CNT_SOCIAL_CIRCLE</td>
      <td>How many observation of client's social surroundings defaulted on 30 DPD (days past due)</td>
    </tr>
    <tr>
      <th>93</th>
      <td>OBS_60_CNT_SOCIAL_CIRCLE</td>
      <td>How many observation of client's social surroundings with observable 60 DPD (days past due) default</td>
    </tr>
    <tr>
      <th>94</th>
      <td>DEF_60_CNT_SOCIAL_CIRCLE</td>
      <td>How many observation of client's social surroundings defaulted on 60 (days past due) DPD</td>
    </tr>
    <tr>
      <th>95</th>
      <td>DAYS_LAST_PHONE_CHANGE</td>
      <td>How many days before application did client change phone</td>
    </tr>
    <tr>
      <th>96</th>
      <td>FLAG_DOCUMENT_2</td>
      <td>Did client provide document 2</td>
    </tr>
    <tr>
      <th>97</th>
      <td>FLAG_DOCUMENT_3</td>
      <td>Did client provide document 3</td>
    </tr>
    <tr>
      <th>98</th>
      <td>FLAG_DOCUMENT_4</td>
      <td>Did client provide document 4</td>
    </tr>
    <tr>
      <th>99</th>
      <td>FLAG_DOCUMENT_5</td>
      <td>Did client provide document 5</td>
    </tr>
    <tr>
      <th>100</th>
      <td>FLAG_DOCUMENT_6</td>
      <td>Did client provide document 6</td>
    </tr>
    <tr>
      <th>101</th>
      <td>FLAG_DOCUMENT_7</td>
      <td>Did client provide document 7</td>
    </tr>
    <tr>
      <th>102</th>
      <td>FLAG_DOCUMENT_8</td>
      <td>Did client provide document 8</td>
    </tr>
    <tr>
      <th>103</th>
      <td>FLAG_DOCUMENT_9</td>
      <td>Did client provide document 9</td>
    </tr>
    <tr>
      <th>104</th>
      <td>FLAG_DOCUMENT_10</td>
      <td>Did client provide document 10</td>
    </tr>
    <tr>
      <th>105</th>
      <td>FLAG_DOCUMENT_11</td>
      <td>Did client provide document 11</td>
    </tr>
    <tr>
      <th>106</th>
      <td>FLAG_DOCUMENT_12</td>
      <td>Did client provide document 12</td>
    </tr>
    <tr>
      <th>107</th>
      <td>FLAG_DOCUMENT_13</td>
      <td>Did client provide document 13</td>
    </tr>
    <tr>
      <th>108</th>
      <td>FLAG_DOCUMENT_14</td>
      <td>Did client provide document 14</td>
    </tr>
    <tr>
      <th>109</th>
      <td>FLAG_DOCUMENT_15</td>
      <td>Did client provide document 15</td>
    </tr>
    <tr>
      <th>110</th>
      <td>FLAG_DOCUMENT_16</td>
      <td>Did client provide document 16</td>
    </tr>
    <tr>
      <th>111</th>
      <td>FLAG_DOCUMENT_17</td>
      <td>Did client provide document 17</td>
    </tr>
    <tr>
      <th>112</th>
      <td>FLAG_DOCUMENT_18</td>
      <td>Did client provide document 18</td>
    </tr>
    <tr>
      <th>113</th>
      <td>FLAG_DOCUMENT_19</td>
      <td>Did client provide document 19</td>
    </tr>
    <tr>
      <th>114</th>
      <td>FLAG_DOCUMENT_20</td>
      <td>Did client provide document 20</td>
    </tr>
    <tr>
      <th>115</th>
      <td>FLAG_DOCUMENT_21</td>
      <td>Did client provide document 21</td>
    </tr>
    <tr>
      <th>116</th>
      <td>AMT_REQ_CREDIT_BUREAU_HOUR</td>
      <td>Number of enquiries to Credit Bureau about the client one hour before application</td>
    </tr>
    <tr>
      <th>117</th>
      <td>AMT_REQ_CREDIT_BUREAU_DAY</td>
      <td>Number of enquiries to Credit Bureau about the client one day before application (excluding one hour before application)</td>
    </tr>
    <tr>
      <th>118</th>
      <td>AMT_REQ_CREDIT_BUREAU_WEEK</td>
      <td>Number of enquiries to Credit Bureau about the client one week before application (excluding one day before application)</td>
    </tr>
    <tr>
      <th>119</th>
      <td>AMT_REQ_CREDIT_BUREAU_MON</td>
      <td>Number of enquiries to Credit Bureau about the client one month before application (excluding one week before application)</td>
    </tr>
    <tr>
      <th>120</th>
      <td>AMT_REQ_CREDIT_BUREAU_QRT</td>
      <td>Number of enquiries to Credit Bureau about the client 3 month before application (excluding one month before application)</td>
    </tr>
    <tr>
      <th>121</th>
      <td>AMT_REQ_CREDIT_BUREAU_YEAR</td>
      <td>Number of enquiries to Credit Bureau about the client one day year (excluding last 3 months before application)</td>
    </tr>
    <tr>
      <th>122</th>
      <td>SK_ID_PREV</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>123</th>
      <td>NAME_CONTRACT_TYPE_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>124</th>
      <td>AMT_ANNUITY_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>125</th>
      <td>AMT_APPLICATION</td>
      <td>For how much credit did client ask on the previous application</td>
    </tr>
    <tr>
      <th>126</th>
      <td>AMT_CREDIT_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>127</th>
      <td>AMT_DOWN_PAYMENT</td>
      <td>Down payment on the previous application</td>
    </tr>
    <tr>
      <th>128</th>
      <td>AMT_GOODS_PRICE_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>129</th>
      <td>WEEKDAY_APPR_PROCESS_START_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>130</th>
      <td>HOUR_APPR_PROCESS_START_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>131</th>
      <td>FLAG_LAST_APPL_PER_CONTRACT</td>
      <td>Flag if it was last application for the previous contract. Sometimes by mistake of client or our clerk there could be more applications for one single contract</td>
    </tr>
    <tr>
      <th>132</th>
      <td>NFLAG_LAST_APPL_IN_DAY</td>
      <td>Flag if the application was the last application per day of the client. Sometimes clients apply for more applications a day. Rarely it could also be error in our system that one application is in the database twice</td>
    </tr>
    <tr>
      <th>133</th>
      <td>RATE_DOWN_PAYMENT</td>
      <td>Down payment rate normalized on previous credit</td>
    </tr>
    <tr>
      <th>134</th>
      <td>RATE_INTEREST_PRIMARY</td>
      <td>Interest rate normalized on previous credit</td>
    </tr>
    <tr>
      <th>135</th>
      <td>RATE_INTEREST_PRIVILEGED</td>
      <td>Interest rate normalized on previous credit</td>
    </tr>
    <tr>
      <th>136</th>
      <td>NAME_CASH_LOAN_PURPOSE</td>
      <td>Purpose of the cash loan</td>
    </tr>
    <tr>
      <th>137</th>
      <td>NAME_CONTRACT_STATUS</td>
      <td>Contract status during the month</td>
    </tr>
    <tr>
      <th>138</th>
      <td>DAYS_DECISION</td>
      <td>Relative to current application when was the decision about previous application made</td>
    </tr>
    <tr>
      <th>139</th>
      <td>NAME_PAYMENT_TYPE</td>
      <td>Payment method that client chose to pay for the previous application</td>
    </tr>
    <tr>
      <th>140</th>
      <td>CODE_REJECT_REASON</td>
      <td>Why was the previous application rejected</td>
    </tr>
    <tr>
      <th>141</th>
      <td>NAME_TYPE_SUITE_y</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>142</th>
      <td>NAME_CLIENT_TYPE</td>
      <td>Was the client old or new client when applying for the previous application</td>
    </tr>
    <tr>
      <th>143</th>
      <td>NAME_GOODS_CATEGORY</td>
      <td>What kind of goods did the client apply for in the previous application</td>
    </tr>
    <tr>
      <th>144</th>
      <td>NAME_PORTFOLIO</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>145</th>
      <td>NAME_PRODUCT_TYPE</td>
      <td>Was the previous application x-sell o walk-in</td>
    </tr>
    <tr>
      <th>146</th>
      <td>CHANNEL_TYPE</td>
      <td>Through which channel we acquired the client on the previous application</td>
    </tr>
    <tr>
      <th>147</th>
      <td>SELLERPLACE_AREA</td>
      <td>Selling area of seller place of the previous application</td>
    </tr>
    <tr>
      <th>148</th>
      <td>NAME_SELLER_INDUSTRY</td>
      <td>The industry of the seller</td>
    </tr>
    <tr>
      <th>149</th>
      <td>CNT_PAYMENT</td>
      <td>Term of previous credit at application of the previous application</td>
    </tr>
    <tr>
      <th>150</th>
      <td>NAME_YIELD_GROUP</td>
      <td>Grouped interest rate into small medium and high of the previous application</td>
    </tr>
    <tr>
      <th>151</th>
      <td>PRODUCT_COMBINATION</td>
      <td>Detailed product combination of the previous application</td>
    </tr>
    <tr>
      <th>152</th>
      <td>DAYS_FIRST_DRAWING</td>
      <td>Relative to application date of current application when was the first disbursement of the previous application</td>
    </tr>
    <tr>
      <th>153</th>
      <td>DAYS_FIRST_DUE</td>
      <td>Relative to application date of current application when was the first due supposed to be of the previous application</td>
    </tr>
    <tr>
      <th>154</th>
      <td>DAYS_LAST_DUE_1ST_VERSION</td>
      <td>Relative to application date of current application when was the first due of the previous application</td>
    </tr>
    <tr>
      <th>155</th>
      <td>DAYS_LAST_DUE</td>
      <td>Relative to application date of current application when was the last due date of the previous application</td>
    </tr>
    <tr>
      <th>156</th>
      <td>DAYS_TERMINATION</td>
      <td>Relative to application date of current application when was the expected termination of the previous application</td>
    </tr>
    <tr>
      <th>157</th>
      <td>NFLAG_INSURED_ON_APPROVAL</td>
      <td>Did the client requested insurance during the previous application</td>
    </tr>
    <tr>
      <th>158</th>
      <td>NUM_INSTALMENT_VERSION_nunique</td>
      <td>Number of unique installment versions in previous loans</td>
    </tr>
    <tr>
      <th>159</th>
      <td>NUM_INSTALMENT_NUMBER_max</td>
      <td>Maximum installment number in previous loans</td>
    </tr>
    <tr>
      <th>160</th>
      <td>AMT_INSTALMENT_sum</td>
      <td>Total installment amount in previous loans</td>
    </tr>
    <tr>
      <th>161</th>
      <td>AMT_INSTALMENT_mean</td>
      <td>Average installment amount in previous loans</td>
    </tr>
    <tr>
      <th>162</th>
      <td>AMT_INSTALMENT_std</td>
      <td>Standard deviation of installment amounts in previous loans</td>
    </tr>
    <tr>
      <th>163</th>
      <td>AMT_INSTALMENT_min</td>
      <td>Minimum installment amount in previous loans</td>
    </tr>
    <tr>
      <th>164</th>
      <td>AMT_INSTALMENT_max</td>
      <td>Maximum installment amount in previous loans</td>
    </tr>
    <tr>
      <th>165</th>
      <td>AMT_PAYMENT_sum</td>
      <td>Total amount paid in previous loans</td>
    </tr>
    <tr>
      <th>166</th>
      <td>AMT_PAYMENT_mean</td>
      <td>Average amount paid in previous loans</td>
    </tr>
    <tr>
      <th>167</th>
      <td>AMT_PAYMENT_std</td>
      <td>Standard deviation of payments in previous loans</td>
    </tr>
    <tr>
      <th>168</th>
      <td>AMT_PAYMENT_min</td>
      <td>Minimum payment amount in previous loans</td>
    </tr>
    <tr>
      <th>169</th>
      <td>AMT_PAYMENT_max</td>
      <td>Maximum payment amount in previous loans</td>
    </tr>
    <tr>
      <th>170</th>
      <td>MONTHS_BALANCE_count</td>
      <td>Number of months of balance records in previous loans</td>
    </tr>
    <tr>
      <th>171</th>
      <td>AMT_BALANCE_mean</td>
      <td>Average balance amount in previous loans</td>
    </tr>
    <tr>
      <th>172</th>
      <td>AMT_BALANCE_std</td>
      <td>Standard deviation of balance amounts in previous loans</td>
    </tr>
    <tr>
      <th>173</th>
      <td>AMT_BALANCE_min</td>
      <td>Minimum balance amount in previous loans</td>
    </tr>
    <tr>
      <th>174</th>
      <td>AMT_BALANCE_max</td>
      <td>Maximum balance amount in previous loans</td>
    </tr>
    <tr>
      <th>175</th>
      <td>AMT_CREDIT_LIMIT_ACTUAL_mean</td>
      <td>Average credit limit in previous credit card loans</td>
    </tr>
    <tr>
      <th>176</th>
      <td>AMT_DRAWINGS_CURRENT_sum</td>
      <td>Total drawings on current credit card loans</td>
    </tr>
    <tr>
      <th>177</th>
      <td>AMT_DRAWINGS_CURRENT_mean</td>
      <td>Average drawings on current credit card loans</td>
    </tr>
    <tr>
      <th>178</th>
      <td>AMT_PAYMENT_CURRENT_sum</td>
      <td>Total current payments in previous credit card loans</td>
    </tr>
    <tr>
      <th>179</th>
      <td>AMT_PAYMENT_CURRENT_mean</td>
      <td>Average current payments in previous credit card loans</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="limpieza-de-datos">
<h1>Limpieza de datos<a class="headerlink" href="#limpieza-de-datos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">classification_report</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span>
    <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">accuracy_score</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">ttest_ind</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Paso 1: Selección de variables ---</span>
<span class="n">selected_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;TARGET&#39;</span><span class="p">,</span> <span class="s1">&#39;EXT_SOURCE_1&#39;</span><span class="p">,</span> <span class="s1">&#39;EXT_SOURCE_2&#39;</span><span class="p">,</span> <span class="s1">&#39;EXT_SOURCE_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AMT_CREDIT_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_ANNUITY_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_GOODS_PRICE_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_INCOME_TOTAL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DAYS_BIRTH&#39;</span><span class="p">,</span> <span class="s1">&#39;DAYS_EMPLOYED&#39;</span><span class="p">,</span> <span class="s1">&#39;DAYS_LAST_PHONE_CHANGE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;REGION_RATING_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;REGION_RATING_CLIENT_W_CITY&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NAME_CONTRACT_TYPE_x&#39;</span><span class="p">,</span> <span class="s1">&#39;CODE_GENDER&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME_PRODUCT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME_YIELD_GROUP&#39;</span>
<span class="p">]</span>

<span class="n">df_filtered</span> <span class="o">=</span> <span class="n">train_final</span><span class="p">[</span><span class="n">selected_columns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;TARGET&#39;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_filtered</span><span class="p">[</span><span class="s1">&#39;TARGET&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Paso 2: División ---</span>
<span class="n">X_train_val</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Paso 3: Preprocesamiento ---</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;EXT_SOURCE_1&#39;</span><span class="p">,</span> <span class="s1">&#39;EXT_SOURCE_2&#39;</span><span class="p">,</span> <span class="s1">&#39;EXT_SOURCE_3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AMT_CREDIT_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_ANNUITY_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_GOODS_PRICE_x&#39;</span><span class="p">,</span> <span class="s1">&#39;AMT_INCOME_TOTAL&#39;</span><span class="p">,</span>
    <span class="s1">&#39;DAYS_BIRTH&#39;</span><span class="p">,</span> <span class="s1">&#39;DAYS_EMPLOYED&#39;</span><span class="p">,</span> <span class="s1">&#39;DAYS_LAST_PHONE_CHANGE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;REGION_RATING_CLIENT&#39;</span><span class="p">,</span> <span class="s1">&#39;REGION_RATING_CLIENT_W_CITY&#39;</span>
<span class="p">]</span>

<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;NAME_CONTRACT_TYPE_x&#39;</span><span class="p">,</span> <span class="s1">&#39;CODE_GENDER&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;NAME_PRODUCT_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NAME_YIELD_GROUP&#39;</span>
<span class="p">]</span>

<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="despliegue-de-modelos">
<h1>Despliegue de modelos<a class="headerlink" href="#despliegue-de-modelos" title="Link to this heading">#</a></h1>
<section id="funcion-para-mostrar-resultados">
<h2>Función para mostrar resultados<a class="headerlink" href="#funcion-para-mostrar-resultados" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">classification_report</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">roc_curve</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">wilcoxon</span>

<span class="k">def</span> <span class="nf">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">,</span> <span class="n">tiempo</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="c1"># Reporte</span>
    <span class="n">reporte</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">target_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Clase 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Clase 1&#39;</span><span class="p">],</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">matriz</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>

    <span class="c1"># -------------------------------</span>
    <span class="c1"># GRÁFICO: MATRIZ DE CONFUSIÓN</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">matriz</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Pred 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Pred 1&#39;</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;True 0&#39;</span><span class="p">,</span> <span class="s1">&#39;True 1&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;🧮 Matriz de Confusión&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicción&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Valor Real&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># -------------------------------</span>
    <span class="c1"># GRÁFICO: CURVA ROC</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_proba</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AUC = </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;📈 Curva ROC&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Falsos Positivos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tasa de Verdaderos Positivos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># -------------------------------</span>
    <span class="c1"># IMPRESIÓN DE MÉTRICAS</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔍 RESUMEN DE DESEMPEÑO DEL MODELO&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⏱️  Tiempo de ejecución total: </span><span class="si">{</span><span class="n">tiempo</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 MÉTRICAS GLOBALES:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Accuracy:        </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Recall (Clase 1):</span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="s1">&#39;Clase 1&#39;</span><span class="p">][</span><span class="s1">&#39;recall&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Precision (Clase 1): </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="s1">&#39;Clase 1&#39;</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - F1-score (Clase 1):  </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="s1">&#39;Clase 1&#39;</span><span class="p">][</span><span class="s1">&#39;f1-score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - AUC:             </span><span class="si">{</span><span class="n">auc</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📌 DESEMPEÑO POR CLASE:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">clase</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Clase 0&#39;</span><span class="p">,</span> <span class="s1">&#39;Clase 1&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ▸ </span><span class="si">{</span><span class="n">clase</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     - Precision: </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="n">clase</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     - Recall:    </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="n">clase</span><span class="p">][</span><span class="s1">&#39;recall&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     - F1-score:  </span><span class="si">{</span><span class="n">reporte</span><span class="p">[</span><span class="n">clase</span><span class="p">][</span><span class="s1">&#39;f1-score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧮 MATRIZ DE CONFUSIÓN:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;         Pred 0    Pred 1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True 0   </span><span class="si">{</span><span class="n">matriz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">7d</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">matriz</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">7d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True 1   </span><span class="si">{</span><span class="n">matriz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">7d</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">matriz</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">7d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>

    <span class="c1"># -------------------------------</span>
    <span class="c1"># WILCOXON + RECALL TRAIN Y TEST</span>
    <span class="k">if</span> <span class="n">y_train_true</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_train_pred</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_test_true</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y_test_pred</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">recall_train</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">recall_test</span>  <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span>  <span class="n">y_test_pred</span><span class="p">,</span>  <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🎯 RECALL Clase 1:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Entrenamiento: </span><span class="si">{</span><span class="n">recall_train</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - Prueba:        </span><span class="si">{</span><span class="n">recall_test</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Muestras binarias para Wilcoxon</span>
        <span class="n">tp_train</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_train_true</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_train_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">tp_test</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_test_true</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_test_pred</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tp_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp_test</span><span class="p">))</span>

        <span class="n">stat</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">wilcoxon</span><span class="p">(</span><span class="n">tp_train</span><span class="p">[:</span><span class="n">min_len</span><span class="p">],</span> <span class="n">tp_test</span><span class="p">[:</span><span class="n">min_len</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🧪 Test de Wilcoxon (recall train vs test):&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - z = </span><span class="si">{</span><span class="n">stat</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   - p-valor = </span><span class="si">{</span><span class="n">pval</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-de-regresion-logistica-con-penalizacion-l1-y-l2">
<h2>Modelo de regresión logística con penalización L1 Y L2<a class="headerlink" href="#modelo-de-regresion-logistica-con-penalizacion-l1-y-l2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Fracción del 20% del train_val para acelerar el GridSearch</span>
<span class="n">X_subsample</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_subsample</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># Pipeline con penalización L2 y solver saga</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># GridSearch con recall y subsample</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;⏳ Entrenando GridSearchCV con subsample del 20%...&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_subsample</span><span class="p">,</span> <span class="n">y_subsample</span><span class="p">)</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Entrenamiento completado en </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> segundos&quot;</span><span class="p">)</span>

<span class="c1"># Mostrar los mejores parámetros encontrados</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🧠 Mejores parámetros encontrados:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🎯 Mejor recall en validación: </span><span class="si">{</span><span class="n">grid</span><span class="o">.</span><span class="n">best_score_</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>⏳ Entrenando GridSearchCV con subsample del 20%...
✅ Entrenamiento completado en 20.39 segundos
🧠 Mejores parámetros encontrados:
{&#39;clf__C&#39;: 1}
🎯 Mejor recall en validación: 0.6523
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Pipeline L2 usando el mejor C encontrado antes</span>
<span class="n">pipeline_l2</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Entrenamiento</span>
<span class="n">start_time_l2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">pipeline_l2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_l2</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_l2</span> <span class="o">=</span> <span class="n">end_time_l2</span> <span class="o">-</span> <span class="n">start_time_l2</span>

<span class="c1"># Predicciones</span>
<span class="n">y_test_pred_l2</span> <span class="o">=</span> <span class="n">pipeline_l2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_l2</span> <span class="o">=</span> <span class="n">pipeline_l2</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred_l2</span> <span class="o">=</span> <span class="n">pipeline_l2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación con función extendida</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📌 Evaluación Modelo: Regresión Logística L2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_l2</span><span class="p">,</span> <span class="n">y_test_proba_l2</span><span class="p">,</span> <span class="n">tiempo_l2</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_l2</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_l2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>📌 Evaluación Modelo: Regresión Logística L2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/c47763f6bc75c294c147b6433c6376850e1e5e316c85a14fe63613962b4a2725.png" src="_images/c47763f6bc75c294c147b6433c6376850e1e5e316c85a14fe63613962b4a2725.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/99ab554d1e651b0c66ddabdbee12e22c9049119d2f40054bc5e613ea87437b52.png" src="_images/99ab554d1e651b0c66ddabdbee12e22c9049119d2f40054bc5e613ea87437b52.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 38.63 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.679
   - Recall (Clase 1):0.662
   - Precision (Clase 1): 0.164
   - F1-score (Clase 1):  0.262
   - AUC:             0.731

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.955
     - Recall:    0.681
     - F1-score:  0.795
  ▸ Clase 1
     - Precision: 0.164
     - Recall:    0.662
     - F1-score:  0.262
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    177910     83453
True 1      8340     16328
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.6603
   - Prueba:        0.6619

🧪 Test de Wilcoxon (recall train vs test):
   - z = 235675155.5000
   - p-valor = 0.4586
==================================================
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="c1"># Pipeline L1 usando el mejor C encontrado antes</span>
<span class="n">pipeline_l1</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Entrenamiento</span>
<span class="n">start_time_l1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">pipeline_l1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_l1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_l1</span> <span class="o">=</span> <span class="n">end_time_l1</span> <span class="o">-</span> <span class="n">start_time_l1</span>

<span class="c1"># Predicciones</span>
<span class="n">y_test_pred_l1</span> <span class="o">=</span> <span class="n">pipeline_l1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_l1</span> <span class="o">=</span> <span class="n">pipeline_l1</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred_l1</span> <span class="o">=</span> <span class="n">pipeline_l1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación con función extendida</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📌 Evaluación Modelo: Regresión Logística L1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_l1</span><span class="p">,</span> <span class="n">y_test_proba_l1</span><span class="p">,</span> <span class="n">tiempo_l1</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_l1</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_l1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>📌 Evaluación Modelo: Regresión Logística L1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/e72123ece992d7002cd55e7ab2b73104891eb61d02ff9098f0ac1034926ae48c.png" src="_images/e72123ece992d7002cd55e7ab2b73104891eb61d02ff9098f0ac1034926ae48c.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/acc41cd0ee4b010e70a55fcf738b7edcfb5ad806d4b14b121ccb561955bafd4b.png" src="_images/acc41cd0ee4b010e70a55fcf738b7edcfb5ad806d4b14b121ccb561955bafd4b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 64.47 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.679
   - Recall (Clase 1):0.662
   - Precision (Clase 1): 0.164
   - F1-score (Clase 1):  0.262
   - AUC:             0.731

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.955
     - Recall:    0.681
     - F1-score:  0.795
  ▸ Clase 1
     - Precision: 0.164
     - Recall:    0.662
     - F1-score:  0.262
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    177918     83445
True 1      8346     16322
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.6604
   - Prueba:        0.6617

🧪 Test de Wilcoxon (recall train vs test):
   - z = 235744416.0000
   - p-valor = 0.4975
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-de-clasificacion-naive-bayes">
<h2>Modelo de clasificación Naive Bayes<a class="headerlink" href="#modelo-de-clasificacion-naive-bayes" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># 🧪 Pipeline con GaussianNB</span>
<span class="n">pipeline_nb</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">())</span>
<span class="p">])</span>

<span class="c1"># 🚀 Entrenamiento</span>
<span class="n">start_time_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">pipeline_nb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_nb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_nb</span> <span class="o">=</span> <span class="n">end_time_nb</span> <span class="o">-</span> <span class="n">start_time_nb</span>

<span class="c1"># 🔮 Predicciones</span>
<span class="n">y_test_pred_nb</span> <span class="o">=</span> <span class="n">pipeline_nb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_nb</span> <span class="o">=</span> <span class="n">pipeline_nb</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred_nb</span> <span class="o">=</span> <span class="n">pipeline_nb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación con función extendida</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📌 Evaluación Modelo: Naive Bayes</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_nb</span><span class="p">,</span> <span class="n">y_test_proba_nb</span><span class="p">,</span> <span class="n">tiempo_nb</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_nb</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_nb</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>📌 Evaluación Modelo: Naive Bayes
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/1c24cc3d466cb04502e93bae049190f20feb46eb16cd0c77bdc327079737870d.png" src="_images/1c24cc3d466cb04502e93bae049190f20feb46eb16cd0c77bdc327079737870d.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/aab649a0e97ebd7278635917ee0f7750b14e81a0db33bdeaac391c1fd3cb85ee.png" src="_images/aab649a0e97ebd7278635917ee0f7750b14e81a0db33bdeaac391c1fd3cb85ee.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 24.66 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.222
   - Recall (Clase 1):0.917
   - Precision (Clase 1): 0.093
   - F1-score (Clase 1):  0.169
   - AUC:             0.678

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.953
     - Recall:    0.157
     - F1-score:  0.269
     - Soporte:   261363

  ▸ Clase 1
     - Precision: 0.093
     - Recall:    0.917
     - F1-score:  0.169
     - Soporte:   24668

🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0     40993    220370
True 1      2043     22625
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.9178
   - Prueba:        0.9172

🧪 Test de Wilcoxon (recall train vs test):
   - z = 428289621.0000
   - p-valor = 0.2311
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-de-clasificacion-random-forest">
<h2>Modelo de clasificación Random Forest<a class="headerlink" href="#modelo-de-clasificacion-random-forest" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="kn">import</span> <span class="n">proportions_ztest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span>
    <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">roc_auc_score</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="kn">import</span> <span class="n">proportions_ztest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span>

<span class="c1"># Scorer personalizado para enfocar el grid en recall clase 1</span>
<span class="n">scorer_recall_clase1</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">recall_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="c1"># 🧪 Submuestreo del 5% para GridSearchCV</span>
<span class="n">X_sampled_rf</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_sampled_rf</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># Pipeline con Random Forest</span>
<span class="n">pipeline_rf</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># GridSearch muy acotado</span>
<span class="n">param_grid_rf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">],</span>
    <span class="s1">&#39;clf__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">grid_rf</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline_rf</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_rf</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scorer_recall_clase1</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># 🚀 GridSearchCV en el subset</span>
<span class="n">grid_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sampled_rf</span><span class="p">,</span> <span class="n">y_sampled_rf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=3,
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_INCOME_TOTAL&#x27;,
                                                                          &#x27;DAYS_BIRTH&#x27;,
                                                                          &#x27;DAYS_EMPLOYED&#x27;,
                                                                          &#x27;DAYS_LAST_PHO...
                                                                                          OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                                         [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                                          &#x27;CODE_GENDER&#x27;,
                                                                          &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                                          &#x27;NAME_YIELD_GROUP&#x27;])])),
                                       (&#x27;smote&#x27;, SMOTE(random_state=42)),
                                       (&#x27;clf&#x27;,
                                        RandomForestClassifier(random_state=42))]),
             n_jobs=1,
             param_grid={&#x27;clf__max_depth&#x27;: [5, 10], &#x27;clf__n_estimators&#x27;: [200]},
             scoring=make_scorer(recall_score, response_method=&#x27;predict&#x27;, pos_label=1))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=3,
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_INCOME_TOTAL&#x27;,
                                                                          &#x27;DAYS_BIRTH&#x27;,
                                                                          &#x27;DAYS_EMPLOYED&#x27;,
                                                                          &#x27;DAYS_LAST_PHO...
                                                                                          OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                                         [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                                          &#x27;CODE_GENDER&#x27;,
                                                                          &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                                          &#x27;NAME_YIELD_GROUP&#x27;])])),
                                       (&#x27;smote&#x27;, SMOTE(random_state=42)),
                                       (&#x27;clf&#x27;,
                                        RandomForestClassifier(random_state=42))]),
             n_jobs=1,
             param_grid={&#x27;clf__max_depth&#x27;: [5, 10], &#x27;clf__n_estimators&#x27;: [200]},
             scoring=make_scorer(recall_score, response_method=&#x27;predict&#x27;, pos_label=1))</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;EXT_SOURCE_1&#x27;,
                                                   &#x27;EXT_SOURCE_2&#x27;,
                                                   &#x27;EXT_SOURCE_3&#x27;,
                                                   &#x27;AMT_CREDIT_x&#x27;,
                                                   &#x27;AMT_ANNUITY_x&#x27;,
                                                   &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                   &#x27;AMT_INCOME_TOTAL&#x27;,
                                                   &#x27;DAYS_BIRTH&#x27;,
                                                   &#x27;DAYS_EMPLOYED&#x27;,
                                                   &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                                   &#x27;REGION_RATING_CLIENT&#x27;,
                                                   &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                   &#x27;CODE_GENDER&#x27;,
                                                   &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                   &#x27;NAME_YIELD_GROUP&#x27;])])),
                (&#x27;smote&#x27;, SMOTE(random_state=42)),
                (&#x27;clf&#x27;, RandomForestClassifier(random_state=42))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessing: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessing: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 [&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;,
                                  &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;,
                                  &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;,
                                  &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;,
                                  &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                  &#x27;REGION_RATING_CLIENT&#x27;,
                                  &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;,
                                  &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;, &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;, &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;, &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;, &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;, &#x27;REGION_RATING_CLIENT&#x27;, &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;, &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">SMOTE</label><div class="sk-toggleable__content fitted"><pre>SMOTE(random_state=42)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=42)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_rf</span> <span class="o">=</span> <span class="n">grid_rf</span><span class="o">.</span><span class="n">best_params_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mejores_rf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;clf__max_depth&#39;: 5, &#39;clf__n_estimators&#39;: 200}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelo_final_rf</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">))</span>
<span class="p">])</span>

<span class="n">start_time_rf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">modelo_final_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_rf</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_rf</span> <span class="o">=</span> <span class="n">end_time_rf</span> <span class="o">-</span> <span class="n">start_time_rf</span>

<span class="c1"># ------------------------------------------</span>
<span class="c1"># 🔮 Predicciones</span>
<span class="n">y_test_pred_rf</span> <span class="o">=</span> <span class="n">modelo_final_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_rf</span> <span class="o">=</span> <span class="n">modelo_final_rf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred_rf</span> <span class="o">=</span> <span class="n">modelo_final_rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación con función extendida</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📌 Evaluación Modelo: Random Forest</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_rf</span><span class="p">,</span> <span class="n">y_test_proba_rf</span><span class="p">,</span> <span class="n">tiempo_rf</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_rf</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_rf</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>📌 Evaluación Modelo: Random Forest
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/c6537565084c2b05f8e5cf7d438d0ba8da868348e6255cd8021d9dfddc5f8726.png" src="_images/c6537565084c2b05f8e5cf7d438d0ba8da868348e6255cd8021d9dfddc5f8726.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/e1b2c430c921624992750082d93827291c7fceec94d6c1d66fc4fb278576eafa.png" src="_images/e1b2c430c921624992750082d93827291c7fceec94d6c1d66fc4fb278576eafa.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 107.96 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.668
   - Recall (Clase 1):0.672
   - Precision (Clase 1): 0.160
   - F1-score (Clase 1):  0.259
   - AUC:             0.727

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.956
     - Recall:    0.668
     - F1-score:  0.786
  ▸ Clase 1
     - Precision: 0.160
     - Recall:    0.672
     - F1-score:  0.259
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    174515     86848
True 1      8095     16573
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.6719
   - Prueba:        0.6718

🧪 Test de Wilcoxon (recall train vs test):
   - z = 241653177.5000
   - p-valor = 0.3648
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-de-clasificacion-xgboost">
<h2>Modelo de clasificación XGBoost<a class="headerlink" href="#modelo-de-clasificacion-xgboost" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="kn">import</span> <span class="n">proportions_ztest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>nvidia-smi
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mon May 19 09:34:55 2025       
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 566.07                 Driver Version: 566.07         CUDA Version: 12.7     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                  Driver-Model | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA GeForce GTX 1650      WDDM  |   00000000:01:00.0 Off |                  N/A |
| N/A   57C    P8              6W /   60W |       0MiB /   4096MiB |      0%      Default |
|                                         |                        |                  N/A |
+-----------------------------------------+------------------------+----------------------+
                                                                                         
+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>

<span class="c1"># Subset de datos para hacer GridSearch más rápido</span>
<span class="n">X_sampled_xgb</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_sampled_xgb</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="n">pipeline_xgb</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
        <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span>  <span class="c1"># Nuevo método oficial</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">))</span>
<span class="p">])</span>


<span class="n">param_grid_xgb</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>
    <span class="s1">&#39;clf__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;clf__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">cv_xgb</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">grid_xgb</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline_xgb</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_xgb</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv_xgb</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">grid_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sampled_xgb</span><span class="p">,</span> <span class="n">y_sampled_xgb</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\xgboost\core.py:729: UserWarning: [09:39:09] WARNING: C:\actions-runner\_work\xgboost\xgboost\src\common\error_msg.cc:58: Falling back to prediction using DMatrix due to mismatched devices. This might lead to higher memory usage and slower performance. XGBoost is running on: cuda:0, while the input data is on: cpu.
Potential solutions:
- Use a data structure that matches the device ordinal in the booster.
- Set the device for booster before call to inplace_predict.

This warning will only be shown once.

  return func(**kwargs)
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_INCOME_TOTAL&#x27;,
                                                                          &#x27;DAYS_BIRTH&#x27;,
                                                                          &#x27;DAYS_EMPLOYED&#x27;,
                                                                          &#x27;DAYS_LAST_PHO...
                                                      max_cat_threshold=None,
                                                      max_cat_to_onehot=None,
                                                      max_delta_step=None,
                                                      max_depth=None,
                                                      max_leaves=None,
                                                      min_child_weight=None,
                                                      missing=nan,
                                                      monotone_constraints=None,
                                                      multi_strategy=None,
                                                      n_estimators=None,
                                                      n_jobs=None,
                                                      num_parallel_tree=None, ...))]),
             n_jobs=1,
             param_grid={&#x27;clf__learning_rate&#x27;: [0.1], &#x27;clf__max_depth&#x27;: [3, 5],
                         &#x27;clf__n_estimators&#x27;: [100, 200]},
             scoring=&#x27;recall&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_INCOME_TOTAL&#x27;,
                                                                          &#x27;DAYS_BIRTH&#x27;,
                                                                          &#x27;DAYS_EMPLOYED&#x27;,
                                                                          &#x27;DAYS_LAST_PHO...
                                                      max_cat_threshold=None,
                                                      max_cat_to_onehot=None,
                                                      max_delta_step=None,
                                                      max_depth=None,
                                                      max_leaves=None,
                                                      min_child_weight=None,
                                                      missing=nan,
                                                      monotone_constraints=None,
                                                      multi_strategy=None,
                                                      n_estimators=None,
                                                      n_jobs=None,
                                                      num_parallel_tree=None, ...))]),
             n_jobs=1,
             param_grid={&#x27;clf__learning_rate&#x27;: [0.1], &#x27;clf__max_depth&#x27;: [3, 5],
                         &#x27;clf__n_estimators&#x27;: [100, 200]},
             scoring=&#x27;recall&#x27;)</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;EXT_SOURCE_1&#x27;,
                                                   &#x27;EXT_SOURCE_2&#x27;,
                                                   &#x27;EXT_SOURCE_3&#x27;,
                                                   &#x27;AMT_CREDIT_x&#x27;,
                                                   &#x27;AMT_ANNUITY_x&#x27;,
                                                   &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                   &#x27;AMT_INCOME_TOTAL&#x27;,
                                                   &#x27;DAYS_BIRTH&#x27;,
                                                   &#x27;DAYS_EMPLOYED&#x27;,
                                                   &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                                   &#x27;REGION_RATING_CL...
                               feature_types=None, feature_weights=None,
                               gamma=None, grow_policy=None,
                               importance_type=None,
                               interaction_constraints=None, learning_rate=None,
                               max_bin=None, max_cat_threshold=None,
                               max_cat_to_onehot=None, max_delta_step=None,
                               max_depth=None, max_leaves=None,
                               min_child_weight=None, missing=nan,
                               monotone_constraints=None, multi_strategy=None,
                               n_estimators=None, n_jobs=None,
                               num_parallel_tree=None, ...))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessing: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessing: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 [&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;,
                                  &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;,
                                  &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;,
                                  &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;,
                                  &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                  &#x27;REGION_RATING_CLIENT&#x27;,
                                  &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;,
                                  &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;, &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;, &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;, &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;, &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;, &#x27;REGION_RATING_CLIENT&#x27;, &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;, &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-9" type="checkbox" ><label for="sk-estimator-id-9" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-10" type="checkbox" ><label for="sk-estimator-id-10" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">SMOTE</label><div class="sk-toggleable__content fitted"><pre>SMOTE(random_state=42)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-11" type="checkbox" ><label for="sk-estimator-id-11" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;XGBClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://xgboost.readthedocs.io/en/release_3.0.0/python/python_api.html#xgboost.XGBClassifier">?<span>Documentation for XGBClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>XGBClassifier(base_score=None, booster=None, callbacks=None,
              colsample_bylevel=None, colsample_bynode=None,
              colsample_bytree=None, device=&#x27;cuda&#x27;, early_stopping_rounds=None,
              enable_categorical=False, eval_metric=&#x27;logloss&#x27;,
              feature_types=None, feature_weights=None, gamma=None,
              grow_policy=None, importance_type=None,
              interaction_constraints=None, learning_rate=None, max_bin=None,
              max_cat_threshold=None, max_cat_to_onehot=None,
              max_delta_step=None, max_depth=None, max_leaves=None,
              min_child_weight=None, missing=nan, monotone_constraints=None,
              multi_strategy=None, n_estimators=None, n_jobs=None,
              num_parallel_tree=None, ...)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_xgb</span> <span class="o">=</span> <span class="n">grid_xgb</span><span class="o">.</span><span class="n">best_params_</span>

<span class="n">modelo_final_xgb</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;smote&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">mejores_xgb</span><span class="p">[</span><span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">],</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">mejores_xgb</span><span class="p">[</span><span class="s1">&#39;clf__max_depth&#39;</span><span class="p">],</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="n">mejores_xgb</span><span class="p">[</span><span class="s1">&#39;clf__learning_rate&#39;</span><span class="p">],</span>
        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
        <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;logloss&#39;</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span>  <span class="c1"># ✅ Nuevo parámetro oficial para GPU</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">))</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_time_xgb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">modelo_final_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_xgb</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_xgb</span> <span class="o">=</span> <span class="n">end_time_xgb</span> <span class="o">-</span> <span class="n">start_time_xgb</span>

<span class="c1"># Predicciones</span>
<span class="n">y_test_pred_xgb</span> <span class="o">=</span> <span class="n">modelo_final_xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_xgb</span> <span class="o">=</span> <span class="n">modelo_final_xgb</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred_xgb</span> <span class="o">=</span> <span class="n">modelo_final_xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación completa con gráfica, AUC, Wilcoxon</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_xgb</span><span class="p">,</span> <span class="n">y_test_proba_xgb</span><span class="p">,</span> <span class="n">tiempo_xgb</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_xgb</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_xgb</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/f1116de06158c5497aa78b96a5445f2f0db53440d5c2c56df273fb106d60a42f.png" src="_images/f1116de06158c5497aa78b96a5445f2f0db53440d5c2c56df273fb106d60a42f.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/1afe34a37c657d87cafe71a48fe03180de93dcbea97f0062a0241130cc315d41.png" src="_images/1afe34a37c657d87cafe71a48fe03180de93dcbea97f0062a0241130cc315d41.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 23.56 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.733
   - Recall (Clase 1):0.586
   - Precision (Clase 1): 0.179
   - F1-score (Clase 1):  0.275
   - AUC:             0.731

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.950
     - Recall:    0.747
     - F1-score:  0.836
  ▸ Clase 1
     - Precision: 0.179
     - Recall:    0.586
     - F1-score:  0.275
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    195212     66151
True 1     10219     14449
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.5841
   - Prueba:        0.5857

🧪 Test de Wilcoxon (recall train vs test):
   - z = 185358420.0000
   - p-valor = 0.1873
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-de-clasificacion-svm">
<h2>Modelo de clasificación SVM<a class="headerlink" href="#modelo-de-clasificacion-svm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">SGDClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span> <span class="k">as</span> <span class="n">ImbPipeline</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="kn">import</span> <span class="n">proportions_ztest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_sampled_sgd</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_sampled_sgd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scorer_recall_clase1</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">recall_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">modelo_svm</span> <span class="o">=</span> <span class="n">SGDClassifier</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;hinge&#39;</span><span class="p">,</span>
    <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">pipeline_svm</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;balanceo&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">modelo_svm</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">param_grid_svm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
    <span class="s1">&#39;classifier__penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;elasticnet&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">cv_svm</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">grid_svm</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline_svm</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_svm</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv_svm</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scorer_recall_clase1</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">grid_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sampled_sgd</span><span class="p">,</span> <span class="n">y_sampled_sgd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_IN...
                                                                         [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                                          &#x27;CODE_GENDER&#x27;,
                                                                          &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                                          &#x27;NAME_YIELD_GROUP&#x27;])])),
                                       (&#x27;balanceo&#x27;, SMOTE(random_state=42)),
                                       (&#x27;classifier&#x27;,
                                        SGDClassifier(n_jobs=-1,
                                                      random_state=42))]),
             n_jobs=1,
             param_grid={&#x27;classifier__alpha&#x27;: [0.0001, 0.001, 0.01],
                         &#x27;classifier__penalty&#x27;: [&#x27;l2&#x27;, &#x27;elasticnet&#x27;]},
             scoring=make_scorer(recall_score, response_method=&#x27;predict&#x27;, pos_label=1))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" ><label for="sk-estimator-id-12" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;GridSearchCV<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.model_selection.GridSearchCV.html">?<span>Documentation for GridSearchCV</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>GridSearchCV(cv=StratifiedKFold(n_splits=3, random_state=42, shuffle=True),
             estimator=Pipeline(steps=[(&#x27;preprocessing&#x27;,
                                        ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                                         Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                                          SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                                         (&#x27;scaler&#x27;,
                                                                                          StandardScaler())]),
                                                                         [&#x27;EXT_SOURCE_1&#x27;,
                                                                          &#x27;EXT_SOURCE_2&#x27;,
                                                                          &#x27;EXT_SOURCE_3&#x27;,
                                                                          &#x27;AMT_CREDIT_x&#x27;,
                                                                          &#x27;AMT_ANNUITY_x&#x27;,
                                                                          &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                                          &#x27;AMT_IN...
                                                                         [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                                          &#x27;CODE_GENDER&#x27;,
                                                                          &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                                          &#x27;NAME_YIELD_GROUP&#x27;])])),
                                       (&#x27;balanceo&#x27;, SMOTE(random_state=42)),
                                       (&#x27;classifier&#x27;,
                                        SGDClassifier(n_jobs=-1,
                                                      random_state=42))]),
             n_jobs=1,
             param_grid={&#x27;classifier__alpha&#x27;: [0.0001, 0.001, 0.01],
                         &#x27;classifier__penalty&#x27;: [&#x27;l2&#x27;, &#x27;elasticnet&#x27;]},
             scoring=make_scorer(recall_score, response_method=&#x27;predict&#x27;, pos_label=1))</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-13" type="checkbox" ><label for="sk-estimator-id-13" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">estimator: Pipeline</label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;EXT_SOURCE_1&#x27;,
                                                   &#x27;EXT_SOURCE_2&#x27;,
                                                   &#x27;EXT_SOURCE_3&#x27;,
                                                   &#x27;AMT_CREDIT_x&#x27;,
                                                   &#x27;AMT_ANNUITY_x&#x27;,
                                                   &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                   &#x27;AMT_INCOME_TOTAL&#x27;,
                                                   &#x27;DAYS_BIRTH&#x27;,
                                                   &#x27;DAYS_EMPLOYED&#x27;,
                                                   &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                                   &#x27;REGION_RATING_CLIENT&#x27;,
                                                   &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                   &#x27;CODE_GENDER&#x27;,
                                                   &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                   &#x27;NAME_YIELD_GROUP&#x27;])])),
                (&#x27;balanceo&#x27;, SMOTE(random_state=42)),
                (&#x27;classifier&#x27;, SGDClassifier(n_jobs=-1, random_state=42))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-14" type="checkbox" ><label for="sk-estimator-id-14" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessing: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessing: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 [&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;,
                                  &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;,
                                  &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;,
                                  &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;,
                                  &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                  &#x27;REGION_RATING_CLIENT&#x27;,
                                  &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;,
                                  &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-15" type="checkbox" ><label for="sk-estimator-id-15" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;, &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;, &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;, &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;, &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;, &#x27;REGION_RATING_CLIENT&#x27;, &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-16" type="checkbox" ><label for="sk-estimator-id-16" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-17" type="checkbox" ><label for="sk-estimator-id-17" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-18" type="checkbox" ><label for="sk-estimator-id-18" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;, &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-19" type="checkbox" ><label for="sk-estimator-id-19" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-20" type="checkbox" ><label for="sk-estimator-id-20" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-21" type="checkbox" ><label for="sk-estimator-id-21" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">SMOTE</label><div class="sk-toggleable__content fitted"><pre>SMOTE(random_state=42)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-22" type="checkbox" ><label for="sk-estimator-id-22" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SGDClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.linear_model.SGDClassifier.html">?<span>Documentation for SGDClassifier</span></a></label><div class="sk-toggleable__content fitted"><pre>SGDClassifier(n_jobs=-1, random_state=42)</pre></div> </div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mejores_svm</span> <span class="o">=</span> <span class="n">grid_svm</span><span class="o">.</span><span class="n">best_params_</span>

<span class="n">modelo_final_svm</span> <span class="o">=</span> <span class="n">ImbPipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;balanceo&#39;</span><span class="p">,</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;classifier&#39;</span><span class="p">,</span> <span class="n">SGDClassifier</span><span class="p">(</span>
        <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;hinge&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">mejores_svm</span><span class="p">[</span><span class="s1">&#39;classifier__alpha&#39;</span><span class="p">],</span>
        <span class="n">penalty</span><span class="o">=</span><span class="n">mejores_svm</span><span class="p">[</span><span class="s1">&#39;classifier__penalty&#39;</span><span class="p">],</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">))</span>
<span class="p">])</span>

<span class="n">start_time_svm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">modelo_final_svm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_svm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_svm</span> <span class="o">=</span> <span class="n">end_time_svm</span> <span class="o">-</span> <span class="n">start_time_svm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_test_pred_svm</span> <span class="o">=</span> <span class="n">modelo_final_svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba_svm</span> <span class="o">=</span> <span class="n">modelo_final_svm</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_train_pred_svm</span> <span class="o">=</span> <span class="n">modelo_final_svm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación completa con gráfica, AUC, Wilcoxon</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred_svm</span><span class="p">,</span> <span class="n">y_test_proba_svm</span><span class="p">,</span> <span class="n">tiempo_svm</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred_svm</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred_svm</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/84b22cd12a677e8cfcd7ddfa200f6d7597f5093ae28b6bcbebb3ee90b0c7cb78.png" src="_images/84b22cd12a677e8cfcd7ddfa200f6d7597f5093ae28b6bcbebb3ee90b0c7cb78.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/8e3bbf99c190f322aafd4ed579f837c5479ca86708d80518e7b7f53ffe99d262.png" src="_images/8e3bbf99c190f322aafd4ed579f837c5479ca86708d80518e7b7f53ffe99d262.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 28.48 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.683
   - Recall (Clase 1):0.657
   - Precision (Clase 1): 0.164
   - F1-score (Clase 1):  0.263
   - AUC:             0.729

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.955
     - Recall:    0.685
     - F1-score:  0.798
     - Soporte:   261363

  ▸ Clase 1
     - Precision: 0.164
     - Recall:    0.657
     - F1-score:  0.263
     - Soporte:   24668

🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    179086     82277
True 1      8473     16195
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.6552
   - Prueba:        0.6565

🧪 Test de Wilcoxon (recall train vs test):
   - z = 231045815.0000
   - p-valor = 0.3359
==================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="propuesta-modelo-original-con-lightgbm">
<h2>Propuesta Modelo Original con LightGBM<a class="headerlink" href="#propuesta-modelo-original-con-lightgbm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span><span class="p">,</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">make_scorer</span><span class="p">,</span> <span class="n">recall_score</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">compute_class_weight</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Subsample de datos</span>
<span class="n">X_sampled_lgbm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">y_sampled_lgbm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Ponderación automática de clase 1 (morosos)</span>
<span class="n">peso_clase</span> <span class="o">=</span> <span class="n">compute_class_weight</span><span class="p">(</span>
    <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
    <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y_sampled_lgbm</span>
<span class="p">)</span>
<span class="n">peso_clase_1</span> <span class="o">=</span> <span class="n">peso_clase</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Scorer enfocado en Recall de morosos</span>
<span class="n">scorer_recall</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">recall_score</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Pipeline simple sin SMOTE (para velocidad)</span>
<span class="n">pipeline_lgbm</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span>
        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;binary_logloss&#39;</span><span class="p">,</span>
        <span class="n">scale_pos_weight</span><span class="o">=</span><span class="n">peso_clase_1</span><span class="p">,</span>
        <span class="n">boosting_type</span><span class="o">=</span><span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">))</span>
<span class="p">])</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Grid de parámetros compacto</span>
<span class="n">param_grid_lgbm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;clf__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;clf__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;clf__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="s1">&#39;clf__num_leaves&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># GridSearchCV rápido</span>
<span class="n">grid_lgbm</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline_lgbm</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_lgbm</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">scorer_recall</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># ----------------------------</span>
<span class="c1"># Entrenar</span>
<span class="n">grid_lgbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_sampled_lgbm</span><span class="p">,</span> <span class="n">y_sampled_lgbm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✅ Mejores parámetros encontrados:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">grid_lgbm</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitting 3 folds for each of 8 candidates, totalling 24 fits
✅ Mejores parámetros encontrados:
{&#39;clf__learning_rate&#39;: 0.1, &#39;clf__max_depth&#39;: 5, &#39;clf__n_estimators&#39;: 100, &#39;clf__num_leaves&#39;: 15}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">modelo_final_lgbm</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;clf&#39;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">num_leaves</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">scale_pos_weight</span><span class="o">=</span><span class="n">peso_clase_1</span><span class="p">,</span>
        <span class="n">objective</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;binary_logloss&#39;</span><span class="p">,</span>
        <span class="n">boosting_type</span><span class="o">=</span><span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">))</span>
<span class="p">])</span>

<span class="n">start_time_lgbm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">modelo_final_lgbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">,</span> <span class="n">y_train_val</span><span class="p">)</span>
<span class="n">end_time_lgbm</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">tiempo_lgbm</span> <span class="o">=</span> <span class="n">end_time_lgbm</span> <span class="o">-</span> <span class="n">start_time_lgbm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predicciones</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">modelo_final_lgbm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_test_proba</span> <span class="o">=</span> <span class="n">modelo_final_lgbm</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">modelo_final_lgbm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_val</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluación</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_pred</span><span class="o">=</span><span class="n">y_test_pred</span><span class="p">,</span>
    <span class="n">y_proba</span><span class="o">=</span><span class="n">y_test_proba</span><span class="p">,</span>
    <span class="n">tiempo</span><span class="o">=</span><span class="n">tiempo_lgbm</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train_val</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">y_train_pred</span><span class="p">,</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_test_pred</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/a58d0381f4b8dada0e297cc1f6eacdaf8c9655a9ac1cb8b7c5e33d5ebd4279ac.png" src="_images/a58d0381f4b8dada0e297cc1f6eacdaf8c9655a9ac1cb8b7c5e33d5ebd4279ac.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/7b2d49bfede3b8fc5573cef6adf4d980349c1e3031a30974a0ae040102b2218d.png" src="_images/7b2d49bfede3b8fc5573cef6adf4d980349c1e3031a30974a0ae040102b2218d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 6.83 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.836
   - Recall (Clase 1):0.444
   - Precision (Clase 1): 0.248
   - F1-score (Clase 1):  0.319
   - AUC:             0.762

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.943
     - Recall:    0.873
     - F1-score:  0.907
  ▸ Clase 1
     - Precision: 0.248
     - Recall:    0.444
     - F1-score:  0.319
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    228209     33154
True 1     13705     10963
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.4478
   - Prueba:        0.4444

🧪 Test de Wilcoxon (recall train vs test):
   - z = 109614780.0000
   - p-valor = 0.4155
==================================================
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="propuesta-de-modelo-bcsca-binary-classification-based-side-channel-analysis">
<h1>Propuesta de modelo: BCSCA (Binary Classification-Based Side-Channel Analysis)<a class="headerlink" href="#propuesta-de-modelo-bcsca-binary-classification-based-side-channel-analysis" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">compute_class_weight</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Input</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.metrics</span> <span class="kn">import</span> <span class="n">Recall</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">BCSCAAdapterBinary</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adaptador scikit-learn compatible para una red neuronal binaria con Keras.</span>
<span class="sd">    Utiliza arquitectura configurable y early stopping basado en recall.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span>
                 <span class="n">hidden_units</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">hidden_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping</span> <span class="o">=</span> <span class="n">early_stopping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_units</span> <span class="o">=</span> <span class="n">hidden_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layers</span> <span class="o">=</span> <span class="n">hidden_layers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_time_</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_layers</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;sigmoid&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;binary_crossentropy&#39;</span><span class="p">,</span>
            <span class="n">optimizer</span><span class="o">=</span><span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">),</span>
            <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recall&#39;</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Asegurar entrada como np.array</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s1">&#39;to_numpy&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">X</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;to_numpy&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">y</span>

        <span class="c1"># Configurar GPU si está disponible</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">gpu</span> <span class="ow">in</span> <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">list_physical_devices</span><span class="p">(</span><span class="s1">&#39;GPU&#39;</span><span class="p">):</span>
                <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">set_memory_growth</span><span class="p">(</span><span class="n">gpu</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Calcular pesos de clase</span>
        <span class="n">class_weights</span> <span class="o">=</span> <span class="n">compute_class_weight</span><span class="p">(</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
        <span class="n">class_weight_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">class_weights</span><span class="p">))</span>

        <span class="c1"># Callbacks</span>
        <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">early_stopping</span><span class="p">:</span>
            <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EarlyStopping</span><span class="p">(</span>
                <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_recall&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span>
                <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_model</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
            <span class="n">class_weight</span><span class="o">=</span><span class="n">class_weight_dict</span><span class="p">,</span>
            <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">training_time_</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">preds</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">preds</span><span class="p">,</span> <span class="n">preds</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Crear pipeline completo</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessing&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;bcsca&#39;</span><span class="p">,</span> <span class="n">BCSCAAdapterBinary</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">hidden_units</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
        <span class="n">hidden_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">early_stopping</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Entrenar modelo</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">15s</span> 2ms/step - accuracy: 0.6771 - loss: 0.6083 - recall: 0.6613 - val_accuracy: 0.6667 - val_loss: 0.6016 - val_recall: 0.6873
Epoch 2/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">13s</span> 2ms/step - accuracy: 0.6847 - loss: 0.5990 - recall: 0.6707 - val_accuracy: 0.6365 - val_loss: 0.6652 - val_recall: 0.7322
Epoch 3/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">13s</span> 2ms/step - accuracy: 0.6855 - loss: 0.5933 - recall: 0.6758 - val_accuracy: 0.6671 - val_loss: 0.5987 - val_recall: 0.7022
Epoch 4/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">14s</span> 2ms/step - accuracy: 0.6850 - loss: 0.5908 - recall: 0.6872 - val_accuracy: 0.6796 - val_loss: 0.6173 - val_recall: 0.7021
Epoch 5/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">14s</span> 2ms/step - accuracy: 0.6871 - loss: 0.5850 - recall: 0.6973 - val_accuracy: 0.6983 - val_loss: 0.5766 - val_recall: 0.6747
Epoch 6/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">13s</span> 2ms/step - accuracy: 0.6906 - loss: 0.5796 - recall: 0.7002 - val_accuracy: 0.7025 - val_loss: 0.5582 - val_recall: 0.6681
Epoch 7/50
<span class=" -Color -Color-Bold">6034/6034</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">14s</span> 2ms/step - accuracy: 0.6910 - loss: 0.5752 - recall: 0.7034 - val_accuracy: 0.7011 - val_loss: 0.5694 - val_recall: 0.6836
</pre></div>
</div>
<div class="output text_html"><style>#sk-container-id-13 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-13 {
  color: var(--sklearn-color-text);
}

#sk-container-id-13 pre {
  padding: 0;
}

#sk-container-id-13 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-13 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-13 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-13 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-13 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-13 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-13 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-13 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-13 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-13 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-13 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-13 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-13 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-13 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-13 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-13 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-13 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-13 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-13 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-13 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-13 div.sk-label label.sk-toggleable__label,
#sk-container-id-13 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-13 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-13 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-13 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-13 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-13 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-13 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-13 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-13 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-13 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-13 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-13 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-13 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-13" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;EXT_SOURCE_1&#x27;,
                                                   &#x27;EXT_SOURCE_2&#x27;,
                                                   &#x27;EXT_SOURCE_3&#x27;,
                                                   &#x27;AMT_CREDIT_x&#x27;,
                                                   &#x27;AMT_ANNUITY_x&#x27;,
                                                   &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                   &#x27;AMT_INCOME_TOTAL&#x27;,
                                                   &#x27;DAYS_BIRTH&#x27;,
                                                   &#x27;DAYS_EMPLOYED&#x27;,
                                                   &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                                   &#x27;REGION_RATING_CLIENT&#x27;,
                                                   &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                   &#x27;CODE_GENDER&#x27;,
                                                   &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                   &#x27;NAME_YIELD_GROUP&#x27;])])),
                (&#x27;bcsca&#x27;, BCSCAAdapterBinary(input_dim=25))])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-109" type="checkbox" ><label for="sk-estimator-id-109" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;Pipeline<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;preprocessing&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;EXT_SOURCE_1&#x27;,
                                                   &#x27;EXT_SOURCE_2&#x27;,
                                                   &#x27;EXT_SOURCE_3&#x27;,
                                                   &#x27;AMT_CREDIT_x&#x27;,
                                                   &#x27;AMT_ANNUITY_x&#x27;,
                                                   &#x27;AMT_GOODS_PRICE_x&#x27;,
                                                   &#x27;AMT_INCOME_TOTAL&#x27;,
                                                   &#x27;DAYS_BIRTH&#x27;,
                                                   &#x27;DAYS_EMPLOYED&#x27;,
                                                   &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                                   &#x27;REGION_RATING_CLIENT&#x27;,
                                                   &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                                  [&#x27;NAME_CONTRACT_TYPE_x&#x27;,
                                                   &#x27;CODE_GENDER&#x27;,
                                                   &#x27;NAME_PRODUCT_TYPE&#x27;,
                                                   &#x27;NAME_YIELD_GROUP&#x27;])])),
                (&#x27;bcsca&#x27;, BCSCAAdapterBinary(input_dim=25))])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-110" type="checkbox" ><label for="sk-estimator-id-110" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;preprocessing: ColumnTransformer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for preprocessing: ColumnTransformer</span></a></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 [&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;,
                                  &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;,
                                  &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;,
                                  &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;,
                                  &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;,
                                  &#x27;REGION_RATING_CLIENT&#x27;,
                                  &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;most_frequent&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(handle_unknown=&#x27;ignore&#x27;))]),
                                 [&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;,
                                  &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-111" type="checkbox" ><label for="sk-estimator-id-111" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">num</label><div class="sk-toggleable__content fitted"><pre>[&#x27;EXT_SOURCE_1&#x27;, &#x27;EXT_SOURCE_2&#x27;, &#x27;EXT_SOURCE_3&#x27;, &#x27;AMT_CREDIT_x&#x27;, &#x27;AMT_ANNUITY_x&#x27;, &#x27;AMT_GOODS_PRICE_x&#x27;, &#x27;AMT_INCOME_TOTAL&#x27;, &#x27;DAYS_BIRTH&#x27;, &#x27;DAYS_EMPLOYED&#x27;, &#x27;DAYS_LAST_PHONE_CHANGE&#x27;, &#x27;REGION_RATING_CLIENT&#x27;, &#x27;REGION_RATING_CLIENT_W_CITY&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-112" type="checkbox" ><label for="sk-estimator-id-112" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-113" type="checkbox" ><label for="sk-estimator-id-113" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;StandardScaler<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-114" type="checkbox" ><label for="sk-estimator-id-114" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">cat</label><div class="sk-toggleable__content fitted"><pre>[&#x27;NAME_CONTRACT_TYPE_x&#x27;, &#x27;CODE_GENDER&#x27;, &#x27;NAME_PRODUCT_TYPE&#x27;, &#x27;NAME_YIELD_GROUP&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-115" type="checkbox" ><label for="sk-estimator-id-115" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;SimpleImputer<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer(strategy=&#x27;most_frequent&#x27;)</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-116" type="checkbox" ><label for="sk-estimator-id-116" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;OneHotEncoder<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(handle_unknown=&#x27;ignore&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-117" type="checkbox" ><label for="sk-estimator-id-117" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">BCSCAAdapterBinary</label><div class="sk-toggleable__content fitted"><pre>BCSCAAdapterBinary(input_dim=25)</pre></div> </div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_val_preprocessed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;bcsca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val_preprocessed</span><span class="p">)</span>
<span class="n">y_proba</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;bcsca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_val_preprocessed</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Prob clase 1</span>

<span class="n">tiempo</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;bcsca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">training_time_</span>
<span class="n">imprimir_resultados_clasificacion</span><span class="p">(</span>
    <span class="n">y_true</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span>
    <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
    <span class="n">y_proba</span><span class="o">=</span><span class="n">y_proba</span><span class="p">,</span>
    <span class="n">tiempo</span><span class="o">=</span><span class="n">tiempo</span><span class="p">,</span>
    <span class="n">y_train_true</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
    <span class="n">y_train_pred</span><span class="o">=</span><span class="n">pipeline</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;bcsca&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)),</span>
    <span class="n">y_test_true</span><span class="o">=</span><span class="n">y_val</span><span class="p">,</span>
    <span class="n">y_test_pred</span><span class="o">=</span><span class="n">y_pred</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 129518 (\N{ABACUS}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/ae64809d99b22ef7b3f473822848c13ffcbc61906a129451d8b2dc3e9f87d6b0.png" src="_images/ae64809d99b22ef7b3f473822848c13ffcbc61906a129451d8b2dc3e9f87d6b0.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ASUS\anaconda3\Lib\site-packages\IPython\core\pylabtools.py:170: UserWarning: Glyph 128200 (\N{CHART WITH UPWARDS TREND}) missing from font(s) DejaVu Sans.
  fig.canvas.print_figure(bytes_io, **kw)
</pre></div>
</div>
<img alt="_images/597a91f843673c553ad10fe95d19f04011cad9c1a5ac46f0c3d93301aaec4712.png" src="_images/597a91f843673c553ad10fe95d19f04011cad9c1a5ac46f0c3d93301aaec4712.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==================================================
        🔍 RESUMEN DE DESEMPEÑO DEL MODELO         
==================================================
⏱️  Tiempo de ejecución total: 96.35 segundos

📊 MÉTRICAS GLOBALES:
   - Accuracy:        0.635
   - Recall (Clase 1):0.736
   - Precision (Clase 1): 0.157
   - F1-score (Clase 1):  0.258
   - AUC:             0.747

📌 DESEMPEÑO POR CLASE:
  ▸ Clase 0
     - Precision: 0.962
     - Recall:    0.626
     - F1-score:  0.758
  ▸ Clase 1
     - Precision: 0.157
     - Recall:    0.736
     - F1-score:  0.258
🧮 MATRIZ DE CONFUSIÓN:
         Pred 0    Pred 1
True 0    163517     97846
True 1      6506     18162
==================================================

🎯 RECALL Clase 1:
   - Entrenamiento: 0.7355
   - Prueba:        0.7363

🧪 Test de Wilcoxon (recall train vs test):
   - z = 288022993.5000
   - p-valor = 0.6961
==================================================
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="EDA%20Home%20Credit%20P1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Análisis Exploratorio de Datos (EDA) - Home Credit Default Risk</p>
      </div>
    </a>
    <a class="right-next"
       href="bitcoin.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ANÁLISIS SERIES DE TIEMPO DE BITCOIN</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Evaluación de Modelos - Home Credit Default Risk</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objetivos-de-esta-etapa">Objetivos de esta etapa</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#carga-de-datos">Carga de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#diccionario-de-datos">Diccionario de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#limpieza-de-datos">Limpieza de datos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#despliegue-de-modelos">Despliegue de modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-para-mostrar-resultados">Función para mostrar resultados</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-regresion-logistica-con-penalizacion-l1-y-l2">Modelo de regresión logística con penalización L1 Y L2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-naive-bayes">Modelo de clasificación Naive Bayes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-random-forest">Modelo de clasificación Random Forest</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-xgboost">Modelo de clasificación XGBoost</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-clasificacion-svm">Modelo de clasificación SVM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-modelo-original-con-lightgbm">Propuesta Modelo Original con LightGBM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#propuesta-de-modelo-bcsca-binary-classification-based-side-channel-analysis">Propuesta de modelo: BCSCA (Binary Classification-Based Side-Channel Analysis)</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Eliana Fuentes, Nicolás Rodriguez y Maria Camila Vargas
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>© 2024 Eliana Fuentes, Nicolás Rodriguez y Maria Camila Vargas</p>
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>